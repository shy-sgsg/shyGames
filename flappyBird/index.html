<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="game-wrapper">
        <div class="game-container">
            <h1>Flappy Bird</h1>
            <div id="game-info">
                <p>分数: <span id="score">0</span></p>
                <p id="message">点击屏幕或按空格键开始</p>
            </div>
            <canvas id="gameCanvas" width="400" height="600"></canvas>
            
            <div id="startScreen">
                <div class="content">
                    <h2>Flappy Bird</h2>
                    <p>准备好挑战了吗？</p>
                    <button id="startGameBtn">开始游戏</button>
                </div>
            </div>
        </div>
        
        <div class="game-controls">
            <button id="pauseBtn" class="control-btn">暂停</button>
            <button id="showLeaderboardBtn" class="control-btn">排行榜</button>
            <button id="returnBtn" class="control-btn">返回主页</button>
        </div>
    </div>

    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeLeaderboardBtn">&times;</span>
            <h2>🏆 排行榜 🏆</h2>
            <ol id="leaderboard" class="leaderboard-list">
                </ol>
        </div>
    </div>

    <div id="scoreModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeScoreModalBtn">&times;</span>
            <h2 id="finalScoreTitle">游戏结束！</h2>
            <p id="finalScoreText"></p>
            <div id="submit-container">
                <p id="modalMessage">恭喜进入前十！请输入你的名字：</p>
                <input type="text" id="playerName" placeholder="玩家名称" maxlength="15">
                <button id="submitScoreBtn" class="modal-btn">提交分数</button>
            </div>
            <div id="retry-container">
                <button id="restartBtn" class="modal-btn">再试一次</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      
        const firebaseConfig = {
            apiKey: "AIzaSyCIRI2D9937f3iwtCJXU6zabDMYT0R18dU",
            authDomain: "game-2048-935e4.firebaseapp.com",
            projectId: "game-2048-935e4",
            storageBucket: "game-2048-935e4.appspot.com",
            messagingSenderId: "561986111957",
            appId: "1:561986111957:web:129c25516ad68c2920d55c"
        };

        // 全局变量，用于离线模式判断
        window.isOfflineMode = false;

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            
            // 将 Firebase 功能挂载到 window 对象，以便 script.js 可以访问
            window.db = db;
            window.collection = collection;
            window.addDoc = addDoc;
            window.getDocs = getDocs;
            window.query = query;
            window.orderBy = orderBy;
            window.limit = limit;
            console.log("Firebase connected successfully!");
        } catch (e) {
            console.error("Firebase initialization failed: ", e);
            window.isOfflineMode = true; // 连接失败，进入离线模式
        }
    </script>
    
    <script src="script.js"></script>
</body>
</html>